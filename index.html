<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Browser-Only PWA</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0f766e">
  <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@2/css/pico.min.css">
  <style>
    .voice-wrap { display:flex; align-items:center; gap:.75rem; }
    .voice-btn {
      display:inline-flex; align-items:center; gap:.5rem;
      border:none; border-radius:9999px; padding:.65rem 1rem;
      font-weight:600; cursor:pointer; color:#fff;
      background:#16a34a; /* green */
      transition:background .15s ease-in-out, transform .05s ease-in-out;
    }
    .voice-btn:active { transform: translateY(1px); }
    .voice-btn.active { background:#dc2626; } /* red */
    .voice-status { font-weight:600; }
    .voice-hint { color:#6b7280; font-size:.9rem; }
    .sr-only {
      position:absolute !important; height:1px; width:1px; overflow:hidden;
      clip:rect(1px, 1px, 1px, 1px); white-space:nowrap; border:0; padding:0; margin:-1px;
    }
    .icon { width:1.1rem; height:1.1rem; }
  </style>
</head>
<body>
  <main class="container">
    <h1>My PWA</h1>

    <!-- Voice recognition control -->
    <section aria-labelledby="voice-title">
      <h2 id="voice-title">Voice recognition</h2>
      <div class="voice-wrap">
        <button id="voice-btn" class="voice-btn" aria-pressed="false" aria-describedby="voice-hint">
          <!-- mic icon (inline SVG) -->
          <svg class="icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M12 14a3 3 0 0 0 3-3V6a3 3 0 1 0-6 0v5a3 3 0 0 0 3 3zm5-3a5 5 0 0 1-10 0H5a7 7 0 0 0 6 6.93V21h2v-3.07A7 7 0 0 0 19 11h-2z"/>
          </svg>
          <span id="voice-btn-label">Start voice recognition</span>
        </button>
        <span id="voice-status" class="voice-status">Idle</span>
      </div>
      <p id="voice-hint" class="voice-hint">
        Click the button to toggle voice recognition. The button turns green (off) or red (on).
      </p>
      <p class="sr-only" id="voice-live" aria-live="polite"></p>
    </section>

    <hr />

    <!-- (Optional) Your existing content can stay below -->
    <p>Status: <span id="net-status">checkingâ€¦</span></p>
  </main>

  <script type="module">
    // --- Online/offline indicator (optional; keeps your original behavior) ---
    const netEl = document.getElementById('net-status');
    function updateNet() { netEl.textContent = navigator.onLine ? 'online' : 'offline'; }
    window.addEventListener('online', updateNet);
    window.addEventListener('offline', updateNet);
    updateNet();

    // --- Register SW (PWA) ---
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js');
    }

    // --- Voice button logic ---
    const btn = document.getElementById('voice-btn');
    const btnLabel = document.getElementById('voice-btn-label');
    const statusEl = document.getElementById('voice-status');
    const liveEl = document.getElementById('voice-live');

    // Speech APIs (progressive enhancement)
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = SpeechRecognition ? new SpeechRecognition() : null;
    if (recognition) {
      recognition.continuous = true;
      recognition.interimResults = false;
      recognition.lang = navigator.language || 'en-US';
      recognition.onstart = () => setStatus('Voice recognition active');
      recognition.onend = () => {
        // If user turned it off, don't auto-restart; otherwise browsers sometimes end on their own.
        if (isActive) return; // do nothing (we stopped it)
      };
      recognition.onerror = () => { /* ignore for now; UI still toggles */ };
      recognition.onresult = (event) => {
        // You can read transcripts here if you want:
        // const last = event.results[event.results.length - 1][0].transcript;
        // console.log('Heard:', last);
      };
    }

    let isActive = false;

    function speak(text) {
      if (!('speechSynthesis' in window)) return;
      try {
        const u = new SpeechSynthesisUtterance(text);
        window.speechSynthesis.speak(u);
      } catch {}
    }

    function setStatus(text) {
      statusEl.textContent = text;
      liveEl.textContent = text; // for screen readers
    }

    function toggleVoice() {
      isActive = !isActive;
      btn.classList.toggle('active', isActive);
      btn.setAttribute('aria-pressed', String(isActive));
      if (isActive) {
        btnLabel.textContent = 'Stop voice recognition';
        setStatus('Voice recognition active');
        speak('Voice recognition active');
        if (recognition) {
          try { recognition.start(); } catch {}
        }
      } else {
        btnLabel.textContent = 'Start voice recognition';
        setStatus('Idle');
        if (recognition) {
          try { recognition.stop(); } catch {}
        }
      }
    }

    btn.addEventListener('click', toggleVoice);
  </script>
</body>
</html>
